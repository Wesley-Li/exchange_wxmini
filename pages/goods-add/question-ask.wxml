<script src="https://cdnjs.cloudflare.com/ajax/libs/qiniu-js/3.1.1/qiniu.min.js"></script>
<view class="question-form">
  <!-- 提交表单按钮  -->
  <view class="btns-box">
    <button class="weui-btn" type="primary" bindtap="submitForm">发布</button>
  </view>
  <view class="select-issue-type">
    <text>选择发布内容类别<text class="color">（必须2选1）</text></text>
    <view class="type-btns">
      <view class="btn {{selectedType == 1 && 'btn-selected'}}" bindtap="onTypeSelect" data-type="1">手记</view>
      <view class="btn {{selectedType == 2 && 'btn-selected'}}" bindtap="onTypeSelect" data-type="2">市集</view>
    </view>
  </view>

  <view class="question-input-area">

    <!-- 问题标题  -->
    <view class="question-title-wrap" wx:if="{{selectedType == 2}}">
      <view class="title-label">标题</view>
      <input class="question-title" placeholder="写标题，吸引更多的人哦" maxlength="40" value="{{title}}" placeholder-style="color: #b3b3b3; font-size: 24rpx;" bindinput="handleTitleInput" bindblur="verifyMessage"></input>
      <view class="title-input-counter">{{titleCount}}/40</view>
    </view>

    <!-- 问题正文  -->
    <view class="weui-cells weui-cells_after-title">
      <view class="weui-cell">
        <view class="weui-cell__bd">
          <view class="label">描述</view>
          <textarea class="weui-textarea" placeholder="{{selectedType == 1 ? '说说您的感受等……' : '说说您的转手原因等……'}}" value="{{content}}" maxlength="500" placeholder-style="color: #999; font-size: 24rpx;" style="height: 6rem" bindinput="handleContentInput" bindblur="verifyMessage" disable-default-padding="{{true}}" />
          <view class="weui-textarea-counter">{{contentCount}}/500</view>
          <!-- <view class="container" style="height:{{editorHeight}}px;">
            <editor id="editor" class="ql-container" placeholder="{{placeholder}}" showImgSize showImgToolbar showImgResize 
            bindstatuschange="onStatusChange" bindready="onEditorReady" bindfocus="onFocus" bindblur="onNoFocus" bindinput="onContentChange">
            </editor>
          </view> -->
        </view>
      </view>

      <view class="set-moments" wx:if="{{selectedType == 1}}">
        <view class="set-location" bindtap="onLocation">
          <image src="/images/location.png" />
          {{cityname || "你在哪里"}}
        </view>
        <view class="weui-cell set-visible">
          <view class="weui-cell__hd">
            <view class="weui-label">
              谁可以看
            </view>
          </view>
          <view class="weui-cell__bd">
            <picker bindchange="bindPickerChange" value="{{visibleValue}}" range-key="name" range="{{visibleList}}" data-param="visibleValue">
            <view class="picker">
              {{visibleList[visibleValue].name}}
              <span>></span>
            </view>
          </picker>
          </view>
        </view>
      </view>
    </view>
  </view>

  <view class="question-images-area" wx:if="{{selectedType == 2}}">
    <!-- 添加图片按钮  -->
    <view class="label">
      缩略图
      <text>选择一张您最喜欢的图，作为您商品的首图</text>
    </view>
    <view class="img-container">
      <!-- 图片缩略图  -->
      <view class="gallery-image" wx:if="{{gallery}}">
        <image class="q-gallery" src="{{gallery}}" mode="aspectFit" bindtap="handleGalleryPreview"></image>
        <view class="q-image-remover" bindtap="removeGallery">删除</view>
      </view>
      <button type="default" size="mini" bindtap="chooseGallery" wx:if="{{!gallery}}">+</button>
    </view>
  </view>

  <view class="question-images-area">
    <!-- 添加图片按钮  -->
    <view class="label">
      短视频
      <text>添加短视频(2分钟内)</text>
    </view>
    <view class="img-container">
      <view class="video-box" wx:if="{{videos.length}}">
        <block wx:for="{{videos}}" wx:key="*this">
          <video class="q-video" src="{{item}}" mode="aspectFill" data-idx="{{index}}"></video>
          <view class="q-image-remover" data-idx="{{index}}" bindtap="removeVideo">删除视频</view>
        </block>
      </view>
      <button type="default" size="mini" bindtap="chooseVideo" wx:if="{{videos.length < 1}}">+</button>
    </view>
  </view>

  <view class="question-images-area">
    <view class="label">
      {{selectedType == 1 ? '图片' : '滚动图'}}
      <text>最多可添加{{selectedType == 1 ? 9 : 3}}张</text>
    </view>
    <view class="img-container">
      <block wx:for="{{images}}" wx:key="*this" wx:if="{{images.length}}">
        <view class="gallery-image">
          <image class="q-image" src="{{item}}" mode="aspectFit" data-idx="{{index}}" bindtap="handleImagePreview"></image>
          <view class="q-image-remover" data-idx="{{index}}" bindtap="removeImage">删除</view>
        </view>
      </block>
      <button type="default" size="mini" bindtap="chooseImage" data-nums="{{selectedType == 1 ? 9 : 3}}" wx:if="{{images.length < (selectedType == 1 ? 9 : 3)}}">+</button>
    </view>
  </view>

  <view class="weui-cell" wx:if="{{selectedType == 2}}">
    <view class="weui-cell__hd">
      <view class="weui-label">
        <image class="label-img" src="/images/classify.png" />
        分类
      </view>
    </view>
    <view class="weui-cell__bd">
      <picker bindchange="bindPickerChange" value="{{index}}" range-key="name" range="{{categories}}" data-param="index">
      <view class="picker">
        {{categories[index].name}}
      </view>
    </picker>
    </view>
  </view>
  <view class="cell-container" wx:if="{{selectedType == 2}}">
    <view class="weui-cell">
      <view class="weui-cell__hd">
        <view class="weui-label">
          <image class="label-img" src="/images/coin.png" />
          信用码
        </view>
      </view>
      <view class="weui-cell__bd">
        <input name="credprice" maxlength="10" class="weui-input" type="digit" placeholder="填写信用码金额" value="{{credprice}}" bindinput="handleCredprice"/>
      </view>
    </view>
    <view class="tip-small">(人民币和蚁库信用码比例为1:10, 请根据原价和旧损情况自行评估)</view>
  </view>
  
  <view class="toolbar" catchtouchend="format" style="bottom: {{isIOS ? keyboardHeight : 50}}px" hidden="{{!showToolbar}}">
    <i class="iconfont icon-charutupian" catchtouchend="insertImage"></i>
    <i class="iconfont icon-format-header-2 {{formats.header === 2 ? 'ql-active' : ''}}" data-name="header" data-value="{{2}}"></i>
    <i class="iconfont icon-format-header-3 {{formats.header === 3 ? 'ql-active' : ''}}" data-name="header" data-value="{{3}}"></i>
    <i class="iconfont icon-zitijiacu {{formats.bold ? 'ql-active' : ''}}" data-name="bold"></i>
    <i class="iconfont icon-zitixieti {{formats.italic ? 'ql-active' : ''}}" data-name="italic"></i>
    <i class="iconfont icon-zitixiahuaxian {{formats.underline ? 'ql-active' : ''}}" data-name="underline"></i>
    <!-- <i class="iconfont icon--checklist" data-name="list" data-value="check"></i> -->
    <i class="iconfont icon-youxupailie {{formats.list === 'ordered' ? 'ql-active' : ''}}" data-name="list" data-value="ordered"></i>
    <i class="iconfont icon-wuxupailie {{formats.list === 'bullet' ? 'ql-active' : ''}}" data-name="list" data-value="bullet"></i>
  </view>
</view>